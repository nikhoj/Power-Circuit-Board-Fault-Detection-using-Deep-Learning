import numpy as np
import skimage as ski
import matplotlib.pyplot as plt






def read_image(loc):
    img = ski.io.imread(loc, True)
    
    return img

def prepare(label):
    d1 = []
    d2 = []
    d3 = []
    for i in range (len(label)):
        
        
        if label[i] == 1:
            d1.append(i)
        elif label[i] == 2:
            d2.append(i)
        elif label[i] == 3:
            d3.append(i)
            
    return d1, d2, d3

 

def bbox_to_rect(bbox, color):
# Convert to matplotlib format: ((upper-left x, upper-left y), width, height).
    return plt.Rectangle(xy=(bbox[0], bbox[1]), width=bbox[2]-bbox[0], height=bbox[3]-bbox[1], fill=False, edgecolor=color, linewidth=2)

def image_prepare(img, box, label, text = "Prediction"):
    
    d1, d2, d3 = prepare(label = label)
    
    plt.figure(figsize = (12,12))
    plt.subplot(122)
    fig = plt.imshow(img, cmap = 'gray')
    plt.title(text)
    for d in [d1,d2,d3]:
        for i in range (len(d)):
            if d == d1:
                fig.axes.add_patch(bbox_to_rect(box[d][i], 'green'))
            elif d == d2:
                fig.axes.add_patch(bbox_to_rect(box[d][i], 'blue'))
            elif d == d3:
                fig.axes.add_patch(bbox_to_rect(box[d][i], 'red'))
    plt.subplot(121)
    plt.title("Test Image")
    fig = plt.imshow(img, cmap = 'gray')
    plt.show()
       

#Faster RCNN start here
#image 1 index 0
box1 = np.array([[268.6544, 301.0776, 299.7691, 330.7202],
        [504.1923, 359.7542, 538.8469, 390.5540],
        [ 40.9020, 192.5398,  74.4500, 222.8577],
        [211.5428, 162.4555, 243.7129, 188.1969],
        [204.1853, 502.4569, 234.4842, 530.6719],
        [510.5191, 477.7553, 543.5847, 505.3925],
        [564.4668, 323.3603, 589.9385, 371.8527],
        [370.4752, 337.1852, 402.4104, 364.6342],
        [ 75.6491, 321.3508, 111.9031, 347.4663],
        [180.9889, 328.0730, 215.3633, 364.6135]] , dtype = int)

label1 = [1, 1, 3, 3, 3, 2, 2, 3, 3, 3]

#image 2 index 3
box2 = np.array([[289.8519, 114.7976, 323.2899, 144.4176],
        [298.3004, 222.5969, 328.2450, 253.3330],
        [520.8696, 324.0602, 554.4291, 358.7575],
        [560.7456, 282.2732, 593.3295, 310.3484],
        [147.4688, 352.4113, 181.6203, 386.9493],
        [346.8758, 166.9636, 382.7000, 193.5145],
        [521.4772, 580.8445, 581.3888, 613.9980],
        [531.9883, 521.3600, 567.6486, 551.4173],
        [527.3254, 425.7007, 549.9206, 458.8332],
        [567.5876, 382.8794, 601.6898, 410.4084]], dtype = int)

label2 = [3, 3, 1, 1, 3, 3, 2, 2, 2, 2]

#image 3 index 10
box3 = np.array([[431.9034, 174.3325, 467.0841, 205.7150],
        [198.0291, 152.1905, 232.0445, 188.6803],
        [ 90.8042, 405.9967, 126.9737, 441.7577],
        [447.3862, 369.1737, 478.5466, 416.2721],
        [ 37.3518, 224.5170,  67.4332, 255.9988],
        [294.1497, 423.0867, 328.8992, 457.9455],
        [319.2069, 388.7328, 349.7805, 426.9032],
        [417.1228, 486.3990, 452.0433, 517.9909],
        [297.7960, 406.9564, 340.1144, 456.4774],
        [ 36.0054, 222.8627,  66.5730, 256.1966]], dtype = int)
    
label3 = [3, 3, 3, 1, 3, 1, 1, 3, 2, 2]

image_prepare(read_image('testimg1.png'), box1, label1)
image_prepare(read_image('testimg2.png'), box2, label2)
image_prepare(read_image('testimg3.png'), box3, label3)


#Mask RCNN start here

box4 = np.array([[ 43.0578, 195.1879,  71.1606, 220.8337],
        [268.8789, 303.9151, 300.4242, 332.2291],
        [210.9814, 163.3489, 243.3850, 188.9930],
        [502.4923, 359.0163, 535.9850, 389.9009],
        [182.9846, 328.4378, 214.3273, 365.0086],
        [512.2057, 477.2514, 543.3863, 505.2540],
        [204.1158, 502.4141, 232.2677, 531.0974],
        [567.4434, 329.7656, 587.0808, 372.8497],
        [396.3661, 200.7721, 428.1886, 232.5388],
        [370.1029, 333.3999, 400.9566, 365.3738]], dtype = int)
    
label4 = [3, 1, 3, 1, 3, 2, 3, 2, 1, 1]

box5 = np.array([[292.6438, 115.6536, 320.2876, 144.5824],
        [299.5279, 223.1255, 325.4087, 252.7275],
        [521.3092, 326.2449, 553.9609, 356.7281],
        [560.4409, 283.0517, 592.6666, 311.0900],
        [149.1618, 354.4750, 180.8928, 388.0505],
        [345.9914, 167.9309, 383.1737, 194.9921],
        [345.3445, 170.7717, 382.7033, 192.8837],
        [569.7734, 385.9958, 600.9059, 409.9945],
        [525.5426, 583.1260, 578.5459, 611.5116],
        [569.4491, 381.9016, 604.3466, 410.0959]], dtype = int)
label5 = [3, 3, 1, 1, 3, 1, 3, 3, 2, 1]

box6 = np.array([[433.6922, 173.5702, 465.9797, 206.1289],
        [200.2178, 154.3335, 229.5121, 190.5410],
        [293.7285, 422.3013, 331.2749, 458.3092],
        [443.1401, 369.6597, 477.7498, 415.9786],
        [419.5533, 486.7138, 448.2615, 519.7300],
        [ 91.8936, 406.4686, 128.1216, 442.3885],
        [320.9286, 387.2312, 351.8343, 428.0984],
        [ 37.3293, 225.1630,  66.6706, 254.7931],
        [416.9300, 483.8416, 454.2274, 519.5037],
        [ 37.3713, 222.5962,  67.3132, 256.8505]], dtype = int)
    
label6 = [3, 3, 1, 1, 3, 3, 1, 3, 1, 1]

image_prepare(read_image('testimg1.png'), box4, label4)
image_prepare(read_image('testimg2.png'), box5, label5)
image_prepare(read_image('testimg3.png'), box6, label6)

#Actual Label start here

box7 = np.array([[269., 304., 300., 333.],
         [504., 362., 534., 389.],
         [510., 477., 547., 505.],
         [204., 501., 232., 531.],
         [210., 161., 243., 188.],
         [ 77., 323., 111., 348.],
         [367., 339., 400., 367.],
         [394., 203., 426., 234.],
         [181., 329., 216., 364.],
         [ 39., 193.,  74., 223.]], dtype = int)
    
label7 = [1, 1, 2, 3, 3, 3, 3, 3, 3, 3]

box8 = np.array([[519., 325., 555., 358.],
         [561., 285., 591., 311.],
         [345., 167., 383., 194.],
         [569., 385., 601., 409.],
         [148., 354., 181., 386.],
         [296., 221., 328., 253.],
         [289., 115., 322., 144.]], dtype = int)
label8 = [1, 1, 3, 3, 3, 3, 3]

box9 = np.array([[444., 375., 479., 420.],
         [290., 391., 353., 456.],
         [418., 485., 452., 518.],
         [ 90., 405., 128., 442.],
         [194., 151., 232., 190.],
         [ 32., 218.,  64., 254.],
         [431., 171., 469., 204.]], dtype = int)
label9 = [1, 1, 3, 3, 3, 3, 3]

image_prepare(read_image('testimg1.png'), box7, label7, "Actual Label")
image_prepare(read_image('testimg2.png'), box8, label8, "Actual Label")
image_prepare(read_image('testimg3.png'), box9, label9, "Actual Label")